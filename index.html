<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
    <title>预览</title>
    <style>
        * {
            padding: 0;
            margin: 0;
        }
        a {
            margin: 10px;
        }
    </style>
</head>
<body>
    <div id="app">
        
    </div>

    <script>
        const getTreeView = (treeData, container) => {
            container = container || document.createElement('div')
            if (Array.isArray(treeData)) {
                treeData.forEach(item => {
                    if (item.isFile) {
                        const link = document.createElement('a')
                        link.href = item.path
                        link.innerText = item.name
                        container.appendChild(link)
                    } else {
                        const childContainer = document.createElement('div')
                        const title = document.createElement('h3')
                        title.innerText = item.name;
                        childContainer.classList.add('directory')
                        childContainer.appendChild(title)
                        container.appendChild(getTreeView(item.child, childContainer))
                    }
                });
            }
            
            return container
        }
        const xhr = new XMLHttpRequest()
        xhr.onload = () => {
            if (xhr.readyState === xhr.DONE) {
                if (xhr.status === 200) {
                    let treeData = JSON.parse(xhr.response || xhr.responseText).data
                    const treeView = getTreeView(treeData)
                    document.getElementById('app').appendChild(treeView)
                }
            }
        }
        xhr.open('GET', `/api/file?reload=${~location.search.indexOf('reload') ? 1 : 0}`)
        xhr.send()



        fetch(`/api/file?reload=${~location.search.indexOf('reload') ? 1 : 0}`, {
            method: 'GET'
        }).then(res =>{
            console.log('headers', res.headers)
            console.log('ok', res.ok)
            console.log('redirected', res.redirected)
            console.log('status', res.status)
            console.log('statusText', res.statusText)
            console.log('type', res.type)
            console.log('url', res.url)
            console.log('body', res.body)
            return res.json()
        }).then(data => console.log(data))
    </script>
</body>
</html>